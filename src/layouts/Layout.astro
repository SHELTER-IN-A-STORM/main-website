---
import { siteConfig } from '../config/site';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import CookieConsent from '../components/CookieConsent.astro';
import AccessibilitySettings from '../components/AccessibilitySettings.astro';
import ChatBox from '../components/ChatBox.astro';
import { loadAnalytics } from '../utils/analytics';

import '../styles/global.css';

interface Props {
	title: string;
}
const { title } = Astro.props;

const formattedTitle = siteConfig.title.template.replace('%s', title);
const canonicalURL = new URL(Astro.url.pathname, Astro.site);

// Health check API endpoint
const HEALTH_CHECK_URL = 'https://api.shelterinastorm.org/api/v2/health';

// Perform health check
try {
  const response = await fetch(HEALTH_CHECK_URL, {
    headers: {
      'Accept': 'application/json'
    }
  });
  const health = await response.json();
  console.log('API Health Status:', health);
} catch (error) {
  console.error('Health check failed:', error);
}
---

<!DOCTYPE html>
<!-- ✨ Built by Ben Trimmer • https://bentrimmer.com/ -->
<!-- ⚠️ Report issues via our Report page • https://shelterinastorm.org/report -->
 
 <html lang={siteConfig.metadata.language} class="scroll-smooth">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content={`Find comprehensive support and resources in Lake Ozark, including emergency assistance, food pantries, and community services. ${siteConfig.description}`} />
		<meta name="keywords" content={siteConfig.metadata.keywords.concat([
			'Lake Ozark community services',
			'Lake Ozark emergency assistance', 
			'Lake Ozark food pantry',
			'Lake Ozark support',
			'Lake Ozark resources',
			'24/7 food assistance',
			'emergency basic needs',
			'Miller County help',
			'Camden County help',
			'crisis prevention',
			'homelessness prevention',
			'utility bill assistance',
			'rent assistance',
			'gas assistance',
			'electric assistance',
			'water assistance',
			'food assistance',
			'clothing assistance',
			'furniture assistance',
			'transportation assistance',
			'medical assistance',
			'mental health assistance',
			'addiction recovery assistance',
			'youth services',
			'LGBTQ+ support',
			'domestic violence support',
			'homelessness prevention',
			'emergency financial help',
			'Christian community support',
			'no paperwork food pantry',
			'immediate food assistance',
			'Lake Ozark Christian Church',
			'faith-based assistance',
			'community partnerships',
			'local emergency help',
			'Lake Ozark charity',
			'food insecurity help',
			'basic needs assistance',
			'temporary crisis help',
			'community food bank',
			'emergency shelter services',
			'Lake Ozark nonprofit',
			'Missouri food assistance',
			'Lake Ozark financial aid'
		]).join(', ')} />
		<meta name="author" content={siteConfig.author} />
		<meta name="theme-color" content={siteConfig.metadata.themeColor} />
		
		<meta property="og:title" content={title} />
		<meta property="og:description" content={siteConfig.description} />
		<meta property="og:image" content={siteConfig.metadata.openGraph.image} />
		<meta property="og:type" content="website" />
		<meta property="og:url" content={canonicalURL} />
		
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:title" content={formattedTitle} />
		<meta name="twitter:description" content={siteConfig.description} />
		<meta name="twitter:image" content={siteConfig.metadata.openGraph.image} />
		
		<meta name="robots" content="index, follow" />
		<link rel="canonical" href={canonicalURL} />
		<link rel="icon" type="image/png" href={siteConfig.metadata.favicon} />
		
		{siteConfig.fonts.google.families.map(family => (
			<link 
				href={`https://fonts.googleapis.com/css2?family=${family}&display=swap`}
				rel="stylesheet"
			/>
		))}
		
		<title>
			{title === 'Welcome' 
				? siteConfig.title.default 
				: siteConfig.title.template.replace('%s', title)
			}
		</title>
		
		<style>
		</style>
	</head>
	<body>
		
		<Header />
		<main id="main-content" class="flex-grow" tabindex="-1">
			<slot />
		</main>
		<Footer />
		<CookieConsent />
		<AccessibilitySettings />
		<ChatBox />

		<script>
		document.addEventListener('DOMContentLoaded', () => {
			fetch('https://api.shelterinastorm.org/api/v2/health', {
				headers: {
					'Accept': 'application/json'
				}
			})
			.then(response => response.json())
			// .then(health => console.log('Client-side API Health Status:', health))
			.catch(error => console.error('Client-side health check failed:', error));

			if (import.meta.env.DEV) {
				setTimeout(() => {
					window.showEventAlert({
						title: 'Development Mode Test Alert',
						description: 'This notification only appears in development mode to test the alert system.',
						image: 'https://cdn-locc-org.vercel.app/media/8F240771-48E1-4868-9BC6-6AB8256F433F.jpeg',
						badge: '[DEV MODE ONLY]',
						actionText: 'Learn More',
						actionUrl: 'https://www.lakeozarkdisciples.org/',
						isExternalLink: true
					});
				}, 1000);
			}
		});
		</script>
	</body>
</html>

<style is:global>
	:root {
		--font-sans: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif;
		--font-handwriting: 'Gochi Hand', cursive;
	}

	html {
		font-family: var(--font-sans);
		-webkit-text-size-adjust: 100%;
		-moz-tab-size: 4;
		tab-size: 4;
	}

	body {
		margin: 0;
		line-height: inherit;
	}

	.skip-to-main-content {
		position: absolute;
		top: -9999px;
		left: 50%;
		transform: translateX(-50%);
		z-index: 9999;
		padding: 1rem 1.5rem;
		background-color: var(--color-brand, #4F46E5);
		color: white;
		font-weight: 500;
		text-decoration: none;
		border-radius: 0 0 0.5rem 0.5rem;
		opacity: 0;
		pointer-events: none;
		transition: opacity 0.2s ease-in-out;
	}

	.skip-to-main-content:focus {
		opacity: 1;
		pointer-events: auto;
		top: 0;
	}

	.skip-to-main-content:hover {
		text-decoration: underline;
	}

	h1, h2, h3, h4, h5, h6 {
		font-weight: 700;
		line-height: 1.2;
	}

	html {
		scroll-behavior: auto;
	}

	.container {
		width: 100%;
		margin-right: auto;
		margin-left: auto;
		padding-right: 1rem;
		padding-left: 1rem;
	}

	@media (min-width: 640px) {
		.container {
			max-width: 640px;
			padding-right: 2rem;
			padding-left: 2rem;
		}
	}

	@media (min-width: 768px) {
		.container {
			max-width: 768px;
		}
	}

	@media (min-width: 1024px) {
		.container {
			max-width: 1024px;
			padding-right: 4rem;
			padding-left: 4rem;
		}
	}

	@media (min-width: 1280px) {
		.container {
			max-width: 1280px;
			padding-right: 5rem;
			padding-left: 5rem;
		}
	}

	/* Skip Navigation Link */
	.skip-nav {
		background: #666ed8;
		color: white;
		padding: 1rem 2rem;
		position: fixed;
		transform: translateY(-120%);
		transition: transform 0.3s;
		left: 1rem;
		top: 1rem;
		z-index: 100;
		border-radius: 0.5rem;
		text-decoration: none;
		font-weight: 500;
		box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
	}

	.skip-nav:focus {
		transform: translateY(0);
	}

	/* Mobile Responsiveness */
	@media (max-width: 640px) {
		.skip-nav {
			left: 0.5rem;
			top: 0.5rem;
			padding: 0.75rem 1.5rem;
		}
	}
</style>

<script>
    function trackEvent(category: string, action: string, label?: string) {
        if (typeof window !== 'undefined' && (window as any).gtag) {
            (window as any).gtag('event', action, {
                event_category: category,
                event_label: label
            });
        }
    }
    window.trackEvent = trackEvent;
</script>

