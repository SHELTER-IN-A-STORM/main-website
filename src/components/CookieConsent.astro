<div 
    id="cookie-consent" 
    class="fixed bottom-8 left-1/2 -translate-x-1/2 w-full max-w-lg mx-auto bg-white rounded-xl border border-gray-100 shadow-xl transform translate-y-[200%] transition-all duration-500 z-50 px-4 invisible opacity-0"
    role="dialog"
    aria-labelledby="cookie-title"
    aria-describedby="cookie-description"
>
    <div class="p-6">
        <div class="flex justify-between items-start mb-4">
            <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-brand" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <title>Cookie Settings Icon</title>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <h3 id="cookie-title" class="text-lg font-semibold text-gray-900">Cookie Settings</h3>
            </div>
            <button 
                id="close-consent"
                class="text-gray-400 hover:text-gray-500 transition-colors"
                aria-label="Close cookie settings"
            >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <title>Close</title>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        
        <p id="cookie-description" class="text-gray-600 text-sm mb-6">
            We use cookies to enhance your experience. Choose your preferences below.
        </p>

        <div class="space-y-4 mb-6">
            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div>
                    <p class="text-sm font-medium text-gray-900" id="essential-label">Essential Cookies</p>
                    <p class="text-xs text-gray-500">Required for the website to function</p>
                </div>
                <input 
                    type="checkbox" 
                    id="essential-cookies"
                    checked 
                    disabled 
                    class="rounded border-gray-300 text-brand focus:ring-brand"
                    aria-labelledby="essential-label"
                >
            </div>
            
            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div>
                    <p class="text-sm font-medium text-gray-900" id="analytics-label">Analytics</p>
                    <p class="text-xs text-gray-500">Help us improve our website</p>
                </div>
                <input 
                    type="checkbox" 
                    id="analytics-cookies"
                    class="rounded border-gray-300 text-brand focus:ring-brand"
                    aria-labelledby="analytics-label"
                >
            </div>
        </div>

        <div class="flex flex-col gap-2">
            <button
                id="accept-all"
                class="w-full px-4 py-2 bg-brand text-white text-sm font-medium rounded-lg hover:bg-brand-dark transition-colors"
                type="button"
            >
                Accept All
            </button>
            <button
                id="save-preferences"
                class="w-full px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-200 transition-colors"
                type="button"
            >
                Save Preferences
            </button>
        </div>

        <div class="mt-4 text-xs text-center text-gray-500">
            <a 
                href="/privacy" 
                class="text-brand hover:text-brand-dark"
                aria-label="View Privacy Policy"
            >
                Privacy Policy
            </a>
        </div>
    </div>
</div>

<script>
    declare global {
        interface Window {
            showCookieConsent: () => void;
        }
    }

    import { trackEvent } from '../utils/analytics';
    
    const cookieConsent = document.getElementById('cookie-consent');
    const acceptAllBtn = document.getElementById('accept-all');
    const savePreferencesBtn = document.getElementById('save-preferences');
    const closeConsentBtn = document.getElementById('close-consent');
    const analyticsCheckbox = document.getElementById('analytics-cookies') as HTMLInputElement;

    // Function to show cookie consent
    function showCookieConsent() {
        if (cookieConsent) {
            cookieConsent.classList.remove('translate-y-[200%]', 'invisible', 'opacity-0');
            cookieConsent.classList.add('translate-y-0', 'visible', 'opacity-100');
        }
    }

    // Function to hide cookie consent
    function hideCookieConsent() {
        if (cookieConsent) {
            cookieConsent.classList.add('translate-y-[200%]', 'invisible', 'opacity-0');
            cookieConsent.classList.remove('translate-y-0', 'visible', 'opacity-100');
        }
    }

    // Check if consent has already been given
    const hasConsent = localStorage.getItem('cookieConsent');
    if (!hasConsent) {
        // Show the consent popup after a short delay
        setTimeout(showCookieConsent, 1000);
    }

    // Load saved preferences
    const savedPreferences = localStorage.getItem('cookiePreferences');
    if (savedPreferences) {
        const preferences = JSON.parse(savedPreferences);
        if (analyticsCheckbox) {
            analyticsCheckbox.checked = preferences.analytics;
        }
    }

    function saveConsent(analytics: boolean) {
        localStorage.setItem('cookieConsent', 'true');
        localStorage.setItem('cookiePreferences', JSON.stringify({
            essential: true,
            analytics: analytics
        }));

        // Track cookie consent choice
        trackEvent('Cookie Consent', 'Click', analytics ? 'Accept All' : 'Custom Preferences');

        hideCookieConsent();

        if (analytics) {
            enableAnalytics();
        } else {
            disableAnalytics();
        }
    }

    function enableAnalytics() {
        // Add your analytics initialization code here
        console.log('Analytics enabled');
    }

    function disableAnalytics() {
        // Add your analytics cleanup code here
        console.log('Analytics disabled');
    }

    // Event listeners
    acceptAllBtn?.addEventListener('click', () => {
        trackEvent('Cookie Consent', 'Click', 'Accept All');
        saveConsent(true);
    });

    savePreferencesBtn?.addEventListener('click', () => {
        trackEvent('Cookie Consent', 'Click', 'Save Preferences');
        saveConsent(analyticsCheckbox?.checked || false);
    });

    closeConsentBtn?.addEventListener('click', () => {
        trackEvent('Cookie Consent', 'Click', 'Close');
        hideCookieConsent();
    });

    // Track checkbox changes
    analyticsCheckbox?.addEventListener('change', (e) => {
        const target = e.target as HTMLInputElement;
        trackEvent('Cookie Consent', 'Toggle Analytics', target.checked ? 'Enabled' : 'Disabled');
    });

    // Make functions available globally
    window.showCookieConsent = showCookieConsent;
</script> 